4edec87042adc5e0c1a7a60782559b76
'use strict';

const reserved = require('types/reserved');

describe('reserved', () => {
  describe('argument `size` is number', () => {
    test('encode', () => {
      const size = 2;
      const wstream = {};

      const itemType = {
        encode: jest.fn().mockImplementation(() => {
          itemType.encode.bytes = size;
        }),
        decode() {}
      };

      const type = reserved(itemType, size);

      type.encode('qqq', wstream);
      expect(itemType.encode).toHaveBeenCalledTimes(size);
      expect(type.encode.bytes).toBe(itemType.encode.bytes * size);
    });

    test('decode', () => {
      const size = 2;
      const rstream = {};
      const bytes = 3;

      const itemType = {
        decode: jest.fn(),
        encode() {}
      };

      itemType.decode.bytes = bytes;

      const type = reserved(itemType, size);

      expect(type.decode(rstream)).toBeUndefined();
      expect(itemType.decode).toHaveBeenCalledTimes(size);
      expect(type.decode.bytes).toEqual(size * bytes);
    });

    test('encodingLength', () => {
      const size = 4;
      const value = 1;
      const length = 2;

      const itemType = {
        decode() {},
        encode() {},
        encodingLength() {
          return length;
        }
      };

      const type = reserved(itemType, size);

      expect(type.encodingLength(value)).toBe(size * length);
    });
  });

  describe('argument `size` is function', () => {
    test('decode', () => {
      const bytes = 10;
      const size = 2;
      const rstream = {};

      const callback = jest.fn().mockImplementation(() => size);

      const itemType = {
        decode: jest.fn(),
        encode() {}
      };

      itemType.decode.bytes = bytes;
      const type = reserved(itemType, callback);

      expect(type.decode(rstream)).toBeUndefined();
      expect(callback).toHaveBeenCalledTimes(1);
      expect(type.decode.bytes).toBe(bytes * size);
    });

    test('encode', () => {
      const size = 2;
      const bytes = 3;
      const wstream = {};
      const callback = jest.fn().mockImplementation(() => size);

      const itemType = {
        encode: jest.fn().mockImplementation(() => {
          itemType.encode.bytes = bytes;
        }),
        decode() {}
      };

      const type = reserved(itemType, callback);
      type.encode('qqq', wstream);

      expect(itemType.encode).toHaveBeenCalledTimes(size);
      expect(callback).toHaveBeenCalledTimes(1);
      expect(type.encode.bytes).toBe(itemType.encode.bytes * size);
    });

    test('encodingLength', () => {
      const size = 2;
      const value = 1;
      const callback = jest.fn().mockImplementation(() => size);
      const length = 2;

      const itemType = {
        decode() {},
        encode() {},
        encodingLength() {
          return length;
        }
      };

      const type = reserved(itemType, callback);

      expect(type.encodingLength(value)).toBe(size * length);
      expect(callback).toHaveBeenCalledTimes(1);
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlc2VydmVkLmpzIl0sIm5hbWVzIjpbInJlc2VydmVkIiwicmVxdWlyZSIsImRlc2NyaWJlIiwidGVzdCIsInNpemUiLCJ3c3RyZWFtIiwiaXRlbVR5cGUiLCJlbmNvZGUiLCJqZXN0IiwiZm4iLCJtb2NrSW1wbGVtZW50YXRpb24iLCJieXRlcyIsImRlY29kZSIsInR5cGUiLCJleHBlY3QiLCJ0b0hhdmVCZWVuQ2FsbGVkVGltZXMiLCJ0b0JlIiwicnN0cmVhbSIsInRvQmVVbmRlZmluZWQiLCJ0b0VxdWFsIiwidmFsdWUiLCJsZW5ndGgiLCJlbmNvZGluZ0xlbmd0aCIsImNhbGxiYWNrIl0sIm1hcHBpbmdzIjoiQUFBQTs7QUFFQSxNQUFNQSxXQUFXQyxRQUFRLGdCQUFSLENBQWpCOztBQUVBQyxTQUFTLFVBQVQsRUFBcUIsTUFBTTtBQUN6QkEsV0FBUywyQkFBVCxFQUFzQyxNQUFNO0FBQzFDQyxTQUFLLFFBQUwsRUFBZSxNQUFNO0FBQ25CLFlBQU1DLE9BQU8sQ0FBYjtBQUNBLFlBQU1DLFVBQVUsRUFBaEI7O0FBRUEsWUFBTUMsV0FBVztBQUNmQyxnQkFBUUMsS0FBS0MsRUFBTCxHQUFVQyxrQkFBVixDQUE2QixNQUFNO0FBQ3pDSixtQkFBU0MsTUFBVCxDQUFnQkksS0FBaEIsR0FBd0JQLElBQXhCO0FBQ0QsU0FGTyxDQURPO0FBSWZRLGlCQUFTLENBQUU7QUFKSSxPQUFqQjs7QUFPQSxZQUFNQyxPQUFPYixTQUFTTSxRQUFULEVBQW1CRixJQUFuQixDQUFiOztBQUVBUyxXQUFLTixNQUFMLENBQVksS0FBWixFQUFtQkYsT0FBbkI7QUFDQVMsYUFBT1IsU0FBU0MsTUFBaEIsRUFBd0JRLHFCQUF4QixDQUE4Q1gsSUFBOUM7QUFDQVUsYUFBT0QsS0FBS04sTUFBTCxDQUFZSSxLQUFuQixFQUEwQkssSUFBMUIsQ0FBK0JWLFNBQVNDLE1BQVQsQ0FBZ0JJLEtBQWhCLEdBQXdCUCxJQUF2RDtBQUNELEtBaEJEOztBQWtCQUQsU0FBSyxRQUFMLEVBQWUs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TixNQUFMLENBQVlJLEtBQW5CLEVBQTBCSyxJQUExQixDQUErQlYsU0FBU0MsTUFBVCxDQUFnQkksS0FBaEIsR0FBd0JQLElBQXZEO0FBQ0QsS0FuQkQ7O0FBcUJBRCxTQUFLLGdCQUFMLEVBQXVCLE1BQU07QUFDM0IsWUFBTUMsT0FBTyxDQUFiO0FBQ0EsWUFBTWdCLFFBQVEsQ0FBZDtBQUNBLFlBQU1HLFdBQVdmLEtBQUtDLEVBQUwsR0FBVUMsa0JBQVYsQ0FBNkIsTUFBTU4sSUFBbkMsQ0FBakI7QUFDQSxZQUFNaUIsU0FBUyxDQUFmOztBQUVBLFlBQU1mLFdBQVc7QUFDZk0saUJBQVMsQ0FBRSxDQURJO0FBRWZMLGlCQUFTLENBQUUsQ0FGSTtBQUdmZSx5QkFBaUI7QUFDZixpQkFBT0QsTUFBUDtBQUNEO0FBTGMsT0FBakI7O0FBUUEsWUFBTVIsT0FBT2IsU0FBU00sUUFBVCxFQUFtQmlCLFFBQW5CLENBQWI7O0FBRUFULGFBQU9ELEtBQUtTLGNBQUwsQ0FBb0JGLEtBQXBCLENBQVAsRUFBbUNKLElBQW5DLENBQXdDWixPQUFPaUIsTUFBL0M7QUFDQVAsYUFBT1MsUUFBUCxFQUFpQlIscUJBQWpCLENBQXVDLENBQXZDO0FBQ0QsS0FsQkQ7QUFtQkQsR0E3REQ7QUE4REQsQ0F4SEQiLCJmaWxlIjoicmVzZXJ2ZWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyIndXNlIHN0cmljdCc7XG5cbmNvbnN0IHJlc2VydmVkID0gcmVxdWlyZSgndHlwZXMvcmVzZXJ2ZWQnKTtcblxuZGVzY3JpYmUoJ3Jlc2VydmVkJywgKCkgPT4ge1xuICBkZXNjcmliZSgnYXJndW1lbnQgYHNpemVgIGlzIG51bWJlcicsICgpID0+IHtcbiAgICB0ZXN0KCdlbmNvZGUnLCAoKSA9PiB7XG4gICAgICBjb25zdCBzaXplID0gMjtcbiAgICAgIGNvbnN0IHdzdHJlYW0gPSB7fTtcblxuICAgICAgY29uc3QgaXRlbVR5cGUgPSB7XG4gICAgICAgIGVuY29kZTogamVzdC5mbigpLm1vY2tJbXBsZW1lbnRhdGlvbigoKSA9PiB7XG4gICAgICAgICAgaXRlbVR5cGUuZW5jb2RlLmJ5dGVzID0gc2l6ZTtcbiAgICAgICAgfSksXG4gICAgICAgIGRlY29kZSgpIHt9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgdHlwZSA9IHJlc2VydmVkKGl0ZW1UeXBlLCBzaXplKTtcblxuICAgICAgdHlwZS5lbmNvZGUoJ3FxcScsIHdzdHJlYW0pO1xuICAgICAgZXhwZWN0KGl0ZW1UeXBlLmVuY29kZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKHNpemUpO1xuICAgICAgZXhwZWN0KHR5cGUuZW5jb2RlLmJ5dGVzKS50b0JlKGl0ZW1UeXBlLmVuY29kZS5ieXRlcyAqIHNpemUpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnZGVjb2RlJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2l6ZSA9IDI7XG4gICAgICBjb25zdCByc3RyZWFtID0ge307XG4gICAgICBjb25zdCBieXRlcyA9IDM7XG5cbiAgICAgIGNvbnN0IGl0ZW1UeXBlID0ge1xuICAgICAgICBkZWNvZGU6IGplc3QuZm4oKSxcbiAgICAgICAgZW5jb2RlKCkge30sXG4gICAgICB9O1xuXG4gICAgICBpdGVtVHlwZS5kZWNvZGUuYnl0ZXMgPSBieXRlcztcblxuICAgICAgY29uc3QgdHlwZSA9IHJlc2VydmVkKGl0ZW1UeXBlLCBzaXplKTtcblxuICAgICAgZXhwZWN0KHR5cGUuZGVjb2RlKHJzdHJlYW0pKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QoaXRlbVR5cGUuZGVjb2RlKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoc2l6ZSk7XG4gICAgICBleHBlY3QodHlwZS5kZWNvZGUuYnl0ZXMpLnRvRXF1YWwoc2l6ZSAqIGJ5dGVzKTtcbiAgICB9KTtcblxuICAgIHRlc3QoJ2VuY29kaW5nTGVuZ3RoJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2l6ZSA9IDQ7XG4gICAgICBjb25zdCB2YWx1ZSA9IDE7XG4gICAgICBjb25zdCBsZW5ndGggPSAyO1xuXG4gICAgICBjb25zdCBpdGVtVHlwZSA9IHtcbiAgICAgICAgZGVjb2RlKCkge30sXG4gICAgICAgIGVuY29kZSgpIHt9LFxuICAgICAgICBlbmNvZGluZ0xlbmd0aCgpIHtcbiAgICAgICAgICByZXR1cm4gbGVuZ3RoO1xuICAgICAgICB9LFxuICAgICAgfTtcblxuICAgICAgY29uc3QgdHlwZSA9IHJlc2VydmVkKGl0ZW1UeXBlLCBzaXplKTtcblxuICAgICAgZXhwZWN0KHR5cGUuZW5jb2RpbmdMZW5ndGgodmFsdWUpKS50b0JlKHNpemUgKiBsZW5ndGgpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZSgnYXJndW1lbnQgYHNpemVgIGlzIGZ1bmN0aW9uJywgKCkgPT4ge1xuICAgIHRlc3QoJ2RlY29kZScsICgpID0+IHtcbiAgICAgIGNvbnN0IGJ5dGVzID0gMTA7XG4gICAgICBjb25zdCBzaXplID0gMjtcbiAgICAgIGNvbnN0IHJzdHJlYW0gPSB7fTtcblxuICAgICAgY29uc3QgY2FsbGJhY2sgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHNpemUpO1xuXG4gICAgICBjb25zdCBpdGVtVHlwZSA9IHtcbiAgICAgICAgZGVjb2RlOiBqZXN0LmZuKCksXG4gICAgICAgIGVuY29kZSgpIHt9LFxuICAgICAgfTtcblxuICAgICAgaXRlbVR5cGUuZGVjb2RlLmJ5dGVzID0gYnl0ZXM7XG4gICAgICBjb25zdCB0eXBlID0gcmVzZXJ2ZWQoaXRlbVR5cGUsIGNhbGxiYWNrKTtcblxuICAgICAgZXhwZWN0KHR5cGUuZGVjb2RlKHJzdHJlYW0pKS50b0JlVW5kZWZpbmVkKCk7XG4gICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICAgIGV4cGVjdCh0eXBlLmRlY29kZS5ieXRlcykudG9CZShieXRlcyAqIHNpemUpO1xuICAgIH0pO1xuXG4gICAgdGVzdCgnZW5jb2RlJywgKCkgPT4ge1xuICAgICAgY29uc3Qgc2l6ZSA9IDI7XG4gICAgICBjb25zdCBieXRlcyA9IDM7XG4gICAgICBjb25zdCB3c3RyZWFtID0ge307XG4gICAgICBjb25zdCBjYWxsYmFjayA9IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4gc2l6ZSk7XG5cbiAgICAgIGNvbnN0IGl0ZW1UeXBlID0ge1xuICAgICAgICBlbmNvZGU6IGplc3QuZm4oKS5tb2NrSW1wbGVtZW50YXRpb24oKCkgPT4ge1xuICAgICAgICAgIGl0ZW1UeXBlLmVuY29kZS5ieXRlcyA9IGJ5dGVzO1xuICAgICAgICB9KSxcbiAgICAgICAgZGVjb2RlKCkge30sXG4gICAgICB9O1xuXG4gICAgICBjb25zdCB0eXBlID0gcmVzZXJ2ZWQoaXRlbVR5cGUsIGNhbGxiYWNrKTtcbiAgICAgIHR5cGUuZW5jb2RlKCdxcXEnLCB3c3RyZWFtKTtcblxuICAgICAgZXhwZWN0KGl0ZW1UeXBlLmVuY29kZSkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKHNpemUpO1xuICAgICAgZXhwZWN0KGNhbGxiYWNrKS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICBleHBlY3QodHlwZS5lbmNvZGUuYnl0ZXMpLnRvQmUoaXRlbVR5cGUuZW5jb2RlLmJ5dGVzICogc2l6ZSk7XG4gICAgfSk7XG5cbiAgICB0ZXN0KCdlbmNvZGluZ0xlbmd0aCcsICgpID0+IHtcbiAgICAgIGNvbnN0IHNpemUgPSAyO1xuICAgICAgY29uc3QgdmFsdWUgPSAxO1xuICAgICAgY29uc3QgY2FsbGJhY2sgPSBqZXN0LmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKCgpID0+IHNpemUpO1xuICAgICAgY29uc3QgbGVuZ3RoID0gMjtcblxuICAgICAgY29uc3QgaXRlbVR5cGUgPSB7XG4gICAgICAgIGRlY29kZSgpIHt9LFxuICAgICAgICBlbmNvZGUoKSB7fSxcbiAgICAgICAgZW5jb2RpbmdMZW5ndGgoKSB7XG4gICAgICAgICAgcmV0dXJuIGxlbmd0aDtcbiAgICAgICAgfSxcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHR5cGUgPSByZXNlcnZlZChpdGVtVHlwZSwgY2FsbGJhY2spO1xuXG4gICAgICBleHBlY3QodHlwZS5lbmNvZGluZ0xlbmd0aCh2YWx1ZSkpLnRvQmUoc2l6ZSAqIGxlbmd0aCk7XG4gICAgICBleHBlY3QoY2FsbGJhY2spLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICB9KTtcbiAgfSk7XG59KTtcbiJdfQ==