{"version":3,"file":"param.js","sourceRoot":"","sources":["../../../../sctp/src/param.ts"],"names":[],"mappings":"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","sourcesContent":["import { jspack } from \"jspack\";\nimport { range } from \"lodash\";\n\n// This parameter is used by the sender to request the reset of some or\n// all outgoing streams.\n//  0                   1                   2                   3\n//  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |     Parameter Type = 13       | Parameter Length = 16 + 2 * N |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |           Re-configuration Request Sequence Number            |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |           Re-configuration Response Sequence Number           |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |                Sender's Last Assigned TSN                     |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |  Stream Number 1 (optional)   |    Stream Number 2 (optional) |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// /                            ......                             /\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |  Stream Number N-1 (optional) |    Stream Number N (optional) |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\nexport class OutgoingSSNResetRequestParam {\n  static type = 13; // Outgoing SSN Reset Request Parameter\n\n  constructor(\n    public requestSequence: number,\n    public responseSequence: number,\n    public lastTsn: number,\n    public streams: number[]\n  ) {}\n\n  get type() {\n    return OutgoingSSNResetRequestParam.type;\n  }\n\n  get bytes() {\n    const data = Buffer.from(\n      jspack.Pack(\"!LLL\", [\n        this.requestSequence,\n        this.responseSequence,\n        this.lastTsn,\n      ])\n    );\n\n    return Buffer.concat([\n      data,\n      ...this.streams.map((stream) => Buffer.from(jspack.Pack(\"!H\", [stream]))),\n    ]);\n  }\n\n  static parse(data: Buffer) {\n    const [requestSequence, responseSequence, lastTsn] = jspack.Unpack(\n      \"!LLL\",\n      data\n    );\n    const stream = range(12, data.length, 2).map(\n      (pos) => jspack.Unpack(\"!H\", data.slice(pos))[0]\n    );\n\n    return new OutgoingSSNResetRequestParam(\n      requestSequence,\n      responseSequence,\n      lastTsn,\n      stream\n    );\n  }\n}\n\nexport class StreamAddOutgoingParam {\n  static type = 17; // Add Outgoing Streams Request Parameter\n\n  constructor(public requestSequence: number, public newStreams: number) {}\n\n  get type() {\n    return StreamAddOutgoingParam.type;\n  }\n\n  get bytes() {\n    return Buffer.from(\n      jspack.Pack(\"!LHH\", [this.requestSequence, this.newStreams, 0])\n    );\n  }\n\n  static parse(data: Buffer) {\n    const [requestSequence, newStreams] = jspack.Unpack(\"!LHH\", data);\n    return new StreamAddOutgoingParam(requestSequence, newStreams);\n  }\n}\n\n// This parameter is used by the receiver of a Re-configuration Request\n// Parameter to respond to the request.\n//\n// 0                   1                   2                   3\n// 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |     Parameter Type = 16       |      Parameter Length         |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |         Re-configuration Response Sequence Number             |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |                            Result                             |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |                   Sender's Next TSN (optional)                |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n// |                  Receiver's Next TSN (optional)               |\n// +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\n\nexport const reconfigResult = {\n  ReconfigResultSuccessPerformed: 1,\n  BadSequenceNumber: 5,\n} as const;\ntype ReconfigResult = typeof reconfigResult[keyof typeof reconfigResult];\n\nexport class ReconfigResponseParam {\n  static type = 16; // Re-configuration Response Parameter\n  constructor(public responseSequence: number, public result: ReconfigResult) {}\n\n  get type() {\n    return ReconfigResponseParam.type;\n  }\n\n  get bytes() {\n    return Buffer.from(\n      jspack.Pack(\"!LL\", [this.responseSequence, this.result])\n    );\n  }\n\n  static parse(data: Buffer) {\n    const [requestSequence, result] = jspack.Unpack(\"!LL\", data);\n    return new ReconfigResponseParam(requestSequence, result as ReconfigResult);\n  }\n}\n\nexport type StreamParam =\n  | OutgoingSSNResetRequestParam\n  | StreamAddOutgoingParam\n  | ReconfigResponseParam;\n\nexport type StreamParamType =\n  | typeof OutgoingSSNResetRequestParam\n  | typeof StreamAddOutgoingParam\n  | typeof ReconfigResponseParam;\n\nexport const RECONFIG_PARAM_BY_TYPES: { [type: number]: StreamParamType } = {\n  13: OutgoingSSNResetRequestParam, // Outgoing SSN Reset Request Parameter\n  16: ReconfigResponseParam, // Re-configuration Response Parameter\n  17: StreamAddOutgoingParam, // Add Outgoing Streams Request Parameter\n};\n"]}