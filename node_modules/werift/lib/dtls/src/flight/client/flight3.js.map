{"version":3,"file":"flight3.js","sourceRoot":"","sources":["../../../../../../dtls/src/flight/client/flight3.ts"],"names":[],"mappings":";;;AAIA,sCAAmC;AAEnC,MAAa,OAAQ,SAAQ,eAAM;IACjC,YAAY,GAAqB,EAAE,IAAiB;QAClD,KAAK,CAAC,GAAG,EAAE,IAAI,EAAE,CAAC,EAAE,CAAC,CAAC,CAAC;IACzB,CAAC;IAED,KAAK,CAAC,IAAI,CAAC,SAAmC;QAC5C,IAAI,IAAI,CAAC,IAAI,CAAC,MAAM,KAAK,CAAC;YAAE,MAAM,IAAI,KAAK,EAAE,CAAC;QAC9C,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,CAAC,CAAC;QAErB,IAAI,CAAC,IAAI,CAAC,cAAc,GAAG,EAAE,CAAC;QAE9B,MAAM,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,CAAC,CAAgB,CAAC;QAC3D,WAAW,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;QACtC,IAAI,CAAC,IAAI,CAAC,MAAM,GAAG,SAAS,CAAC,MAAM,CAAC;QAEpC,MAAM,OAAO,GAAG,IAAI,CAAC,YAAY,CAAC,CAAC,WAAW,CAAC,CAAC,CAAC;QAEjD,MAAM,GAAG,GAAG,MAAM,CAAC,MAAM,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,SAAS,EAAE,CAAC,CAAC,CAAC;QAC7D,MAAM,IAAI,CAAC,QAAQ,CAAC,CAAC,GAAG,CAAC,CAAC,CAAC;IAC7B,CAAC;CACF;AApBD,0BAoBC","sourcesContent":["import { DtlsContext } from \"../../context/dtls\";\nimport { TransportContext } from \"../../context/transport\";\nimport { ClientHello } from \"../../handshake/message/client/hello\";\nimport { ServerHelloVerifyRequest } from \"../../handshake/message/server/helloVerifyRequest\";\nimport { Flight } from \"../flight\";\n\nexport class Flight3 extends Flight {\n  constructor(udp: TransportContext, dtls: DtlsContext) {\n    super(udp, dtls, 3, 5);\n  }\n\n  async exec(verifyReq: ServerHelloVerifyRequest) {\n    if (this.dtls.flight === 3) throw new Error();\n    this.dtls.flight = 3;\n\n    this.dtls.handshakeCache = [];\n\n    const clientHello = this.dtls.lastFlight[0] as ClientHello;\n    clientHello.cookie = verifyReq.cookie;\n    this.dtls.cookie = verifyReq.cookie;\n\n    const packets = this.createPacket([clientHello]);\n\n    const buf = Buffer.concat(packets.map((v) => v.serialize()));\n    await this.transmit([buf]);\n  }\n}\n"]}