{"version":3,"file":"Firefox60.js","sourceRoot":"","sources":["../../src/handlers/Firefox60.ts"],"names":[],"mappings":"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","sourcesContent":["import * as sdpTransform from 'sdp-transform';\nimport { Logger } from '../Logger';\nimport { UnsupportedError } from '../errors';\nimport * as utils from '../utils';\nimport * as ortc from '../ortc';\nimport * as sdpCommonUtils from './sdp/commonUtils';\nimport * as sdpUnifiedPlanUtils from './sdp/unifiedPlanUtils';\nimport {\n\tHandlerFactory,\n\tHandlerInterface,\n\tHandlerRunOptions,\n\tHandlerSendOptions,\n\tHandlerSendResult,\n\tHandlerReceiveOptions,\n\tHandlerReceiveResult,\n\tHandlerSendDataChannelOptions,\n\tHandlerSendDataChannelResult,\n\tHandlerReceiveDataChannelOptions,\n\tHandlerReceiveDataChannelResult\n} from './HandlerInterface';\nimport { RemoteSdp } from './sdp/RemoteSdp';\nimport { IceParameters, DtlsRole } from '../Transport';\nimport { RtpCapabilities, RtpParameters } from '../RtpParameters';\nimport { SctpCapabilities, SctpStreamParameters } from '../SctpParameters';\n\nconst logger = new Logger('Firefox60');\n\nconst SCTP_NUM_STREAMS = { OS: 16, MIS: 2048 };\n\nexport class Firefox60 extends HandlerInterface\n{\n\t// Handler direction.\n\tprivate _direction?: 'send' | 'recv';\n\t// Remote SDP handler.\n\tprivate _remoteSdp?: RemoteSdp;\n\t// Generic sending RTP parameters for audio and video.\n\tprivate _sendingRtpParametersByKind?: { [key: string]: RtpParameters };\n\t// Generic sending RTP parameters for audio and video suitable for the SDP\n\t// remote answer.\n\tprivate _sendingRemoteRtpParametersByKind?: { [key: string]: RtpParameters };\n\t// RTCPeerConnection instance.\n\tprivate _pc: any;\n\t// Map of RTCTransceivers indexed by MID.\n\tprivate readonly _mapMidTransceiver: Map<string, RTCRtpTransceiver> =\n\t\tnew Map();\n\t// Local stream for sending.\n\tprivate readonly _sendStream = new MediaStream();\n\t// Whether a DataChannel m=application section has been created.\n\tprivate _hasDataChannelMediaSection = false;\n\t// Sending DataChannel id value counter. Incremented for each new DataChannel.\n\tprivate _nextSendSctpStreamId = 0;\n\t// Got transport local and remote parameters.\n\tprivate _transportReady = false;\n\n\t/**\n\t * Creates a factory function.\n\t */\n\tstatic createFactory(): HandlerFactory\n\t{\n\t\treturn (): Firefox60 => new Firefox60();\n\t}\n\n\tconstructor()\n\t{\n\t\tsuper();\n\t}\n\n\tget name(): string\n\t{\n\t\treturn 'Firefox60';\n\t}\n\n\tclose(): void\n\t{\n\t\tlogger.debug('close()');\n\n\t\t// Close RTCPeerConnection.\n\t\tif (this._pc)\n\t\t{\n\t\t\ttry { this._pc.close(); }\n\t\t\tcatch (error) {}\n\t\t}\n\t}\n\n\tasync getNativeRtpCapabilities(): Promise<RtpCapabilities>\n\t{\n\t\tlogger.debug('getNativeRtpCapabilities()');\n\n\t\tconst pc = new (RTCPeerConnection as any)(\n\t\t\t{\n\t\t\t\ticeServers         : [],\n\t\t\t\ticeTransportPolicy : 'all',\n\t\t\t\tbundlePolicy       : 'max-bundle',\n\t\t\t\trtcpMuxPolicy      : 'require'\n\t\t\t});\n\n\t\t// NOTE: We need to add a real video track to get the RID extension mapping.\n\t\tconst canvas = document.createElement('canvas');\n\n\t\t// NOTE: Otherwise Firefox fails in next line.\n\t\tcanvas.getContext('2d');\n\n\t\tconst fakeStream = (canvas as any).captureStream();\n\t\tconst fakeVideoTrack = fakeStream.getVideoTracks()[0];\n\n\t\ttry\n\t\t{\n\t\t\tpc.addTransceiver('audio', { direction: 'sendrecv' });\n\n\t\t\tconst videoTransceiver =\n\t\t\t\tpc.addTransceiver(fakeVideoTrack, { direction: 'sendrecv' });\n\t\t\tconst parameters = videoTransceiver.sender.getParameters();\n\t\t\tconst encodings =\n\t\t\t[\n\t\t\t\t{ rid: 'r0', maxBitrate: 100000 },\n\t\t\t\t{ rid: 'r1', maxBitrate: 500000 }\n\t\t\t];\n\n\t\t\tparameters.encodings = encodings;\n\t\t\tawait videoTransceiver.sender.setParameters(parameters);\n\n\t\t\tconst offer = await pc.createOffer();\n\n\t\t\ttry { canvas.remove(); }\n\t\t\tcatch (error) {}\n\n\t\t\ttry { fakeVideoTrack.stop(); }\n\t\t\tcatch (error) {}\n\n\t\t\ttry { pc.close(); }\n\t\t\tcatch (error) {}\n\n\t\t\tconst sdpObject = sdpTransform.parse(offer.sdp);\n\t\t\tconst nativeRtpCapabilities =\n\t\t\t\tsdpCommonUtils.extractRtpCapabilities({ sdpObject });\n\n\t\t\treturn nativeRtpCapabilities;\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\ttry { canvas.remove(); }\n\t\t\tcatch (error2) {}\n\n\t\t\ttry { fakeVideoTrack.stop(); }\n\t\t\tcatch (error2) {}\n\n\t\t\ttry { pc.close(); }\n\t\t\tcatch (error2) {}\n\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\tasync getNativeSctpCapabilities(): Promise<SctpCapabilities>\n\t{\n\t\tlogger.debug('getNativeSctpCapabilities()');\n\n\t\treturn {\n\t\t\tnumStreams : SCTP_NUM_STREAMS\n\t\t};\n\t}\n\n\trun(\n\t\t{\n\t\t\tdirection,\n\t\t\ticeParameters,\n\t\t\ticeCandidates,\n\t\t\tdtlsParameters,\n\t\t\tsctpParameters,\n\t\t\ticeServers,\n\t\t\ticeTransportPolicy,\n\t\t\tadditionalSettings,\n\t\t\tproprietaryConstraints,\n\t\t\textendedRtpCapabilities\n\t\t}: HandlerRunOptions\n\t): void\n\t{\n\t\tlogger.debug('run()');\n\n\t\tthis._direction = direction;\n\n\t\tthis._remoteSdp = new RemoteSdp(\n\t\t\t{\n\t\t\t\ticeParameters,\n\t\t\t\ticeCandidates,\n\t\t\t\tdtlsParameters,\n\t\t\t\tsctpParameters\n\t\t\t});\n\n\t\tthis._sendingRtpParametersByKind =\n\t\t{\n\t\t\taudio : ortc.getSendingRtpParameters('audio', extendedRtpCapabilities),\n\t\t\tvideo : ortc.getSendingRtpParameters('video', extendedRtpCapabilities)\n\t\t};\n\n\t\tthis._sendingRemoteRtpParametersByKind =\n\t\t{\n\t\t\taudio : ortc.getSendingRemoteRtpParameters('audio', extendedRtpCapabilities),\n\t\t\tvideo : ortc.getSendingRemoteRtpParameters('video', extendedRtpCapabilities)\n\t\t};\n\n\t\tthis._pc = new (RTCPeerConnection as any)(\n\t\t\t{\n\t\t\t\ticeServers         : iceServers || [],\n\t\t\t\ticeTransportPolicy : iceTransportPolicy || 'all',\n\t\t\t\tbundlePolicy       : 'max-bundle',\n\t\t\t\trtcpMuxPolicy      : 'require',\n\t\t\t\t...additionalSettings\n\t\t\t},\n\t\t\tproprietaryConstraints);\n\n\t\t// Handle RTCPeerConnection connection status.\n\t\tthis._pc.addEventListener('iceconnectionstatechange', () =>\n\t\t{\n\t\t\tswitch (this._pc.iceConnectionState)\n\t\t\t{\n\t\t\t\tcase 'checking':\n\t\t\t\t\tthis.emit('@connectionstatechange', 'connecting');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'connected':\n\t\t\t\tcase 'completed':\n\t\t\t\t\tthis.emit('@connectionstatechange', 'connected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'failed':\n\t\t\t\t\tthis.emit('@connectionstatechange', 'failed');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'disconnected':\n\t\t\t\t\tthis.emit('@connectionstatechange', 'disconnected');\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'closed':\n\t\t\t\t\tthis.emit('@connectionstatechange', 'closed');\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t});\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/no-unused-vars\n\tasync updateIceServers(iceServers: RTCIceServer[]): Promise<void>\n\t{\n\t\t// NOTE: Firefox does not implement pc.setConfiguration().\n\t\tthrow new UnsupportedError('not supported');\n\t}\n\n\tasync restartIce(iceParameters: IceParameters): Promise<void>\n\t{\n\t\tlogger.debug('restartIce()');\n\n\t\t// Provide the remote SDP handler with new remote ICE parameters.\n\t\tthis._remoteSdp!.updateIceParameters(iceParameters);\n\n\t\tif (!this._transportReady)\n\t\t\treturn;\n\n\t\tif (this._direction === 'send')\n\t\t{\n\t\t\tconst offer = await this._pc.createOffer({ iceRestart: true });\n\n\t\t\tlogger.debug(\n\t\t\t\t'restartIce() | calling pc.setLocalDescription() [offer:%o]',\n\t\t\t\toffer);\n\n\t\t\tawait this._pc.setLocalDescription(offer);\n\n\t\t\tconst answer = { type: 'answer', sdp: this._remoteSdp!.getSdp() };\n\n\t\t\tlogger.debug(\n\t\t\t\t'restartIce() | calling pc.setRemoteDescription() [answer:%o]',\n\t\t\t\tanswer);\n\n\t\t\tawait this._pc.setRemoteDescription(answer);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconst offer = { type: 'offer', sdp: this._remoteSdp!.getSdp() };\n\n\t\t\tlogger.debug(\n\t\t\t\t'restartIce() | calling pc.setRemoteDescription() [offer:%o]',\n\t\t\t\toffer);\n\n\t\t\tawait this._pc.setRemoteDescription(offer);\n\n\t\t\tconst answer = await this._pc.createAnswer();\n\n\t\t\tlogger.debug(\n\t\t\t\t'restartIce() | calling pc.setLocalDescription() [answer:%o]',\n\t\t\t\tanswer);\n\n\t\t\tawait this._pc.setLocalDescription(answer);\n\t\t}\n\t}\n\n\tasync getTransportStats(): Promise<RTCStatsReport>\n\t{\n\t\treturn this._pc.getStats();\n\t}\n\n\tasync send(\n\t\t{ track, encodings, codecOptions, codec }: HandlerSendOptions\n\t): Promise<HandlerSendResult>\n\t{\n\t\tthis._assertSendDirection();\n\n\t\tlogger.debug('send() [kind:%s, track.id:%s]', track.kind, track.id);\n\n\t\tif (encodings)\n\t\t{\n\t\t\tencodings = utils.clone(encodings, []);\n\n\t\t\tif (encodings!.length > 1)\n\t\t\t{\n\t\t\t\tencodings!.forEach((encoding, idx) =>\n\t\t\t\t{\n\t\t\t\t\tencoding.rid = `r${idx}`;\n\t\t\t\t});\n\n\t\t\t\t// Clone the encodings and reverse them because Firefox likes them\n\t\t\t\t// from high to low.\n\t\t\t\tencodings!.reverse();\n\t\t\t}\n\t\t}\n\n\t\tconst sendingRtpParameters =\n\t\t\tutils.clone(this._sendingRtpParametersByKind![track.kind], {});\n\n\t\t// This may throw.\n\t\tsendingRtpParameters.codecs =\n\t\t\tortc.reduceCodecs(sendingRtpParameters.codecs, codec);\n\n\t\tconst sendingRemoteRtpParameters =\n\t\t\tutils.clone(this._sendingRemoteRtpParametersByKind![track.kind], {});\n\n\t\t// This may throw.\n\t\tsendingRemoteRtpParameters.codecs =\n\t\t\tortc.reduceCodecs(sendingRemoteRtpParameters.codecs, codec);\n\n\t\t// NOTE: Firefox fails sometimes to properly anticipate the closed media\n\t\t// section that it should use, so don't reuse closed media sections.\n\t\t//   https://github.com/versatica/mediasoup-client/issues/104\n\t\t//\n\t\t// const mediaSectionIdx = this._remoteSdp!.getNextMediaSectionIdx();\n\t\tconst transceiver = this._pc.addTransceiver(\n\t\t\ttrack, { direction: 'sendonly', streams: [ this._sendStream ] });\n\n\t\t// NOTE: This is not spec compliants. Encodings should be given in addTransceiver\n\t\t// second argument, but Firefox does not support it.\n\t\tif (encodings)\n\t\t{\n\t\t\tconst parameters = transceiver.sender.getParameters();\n\n\t\t\tparameters.encodings = encodings;\n\t\t\tawait transceiver.sender.setParameters(parameters);\n\t\t}\n\n\t\tconst offer = await this._pc.createOffer();\n\t\tlet localSdpObject = sdpTransform.parse(offer.sdp);\n\n\t\t// In Firefox use DTLS role client even if we are the \"offerer\" since\n\t\t// Firefox does not respect ICE-Lite.\n\t\tif (!this._transportReady)\n\t\t\tawait this._setupTransport({ localDtlsRole: 'client', localSdpObject });\n\n\t\tlogger.debug(\n\t\t\t'send() | calling pc.setLocalDescription() [offer:%o]',\n\t\t\toffer);\n\n\t\tawait this._pc.setLocalDescription(offer);\n\n\t\t// We can now get the transceiver.mid.\n\t\tconst localId = transceiver.mid;\n\n\t\t// Set MID.\n\t\tsendingRtpParameters.mid = localId;\n\n\t\tlocalSdpObject = sdpTransform.parse(this._pc.localDescription.sdp);\n\n\t\tconst offerMediaObject = localSdpObject.media[localSdpObject.media.length - 1];\n\n\t\t// Set RTCP CNAME.\n\t\tsendingRtpParameters.rtcp.cname =\n\t\t\tsdpCommonUtils.getCname({ offerMediaObject });\n\n\t\t// Set RTP encodings by parsing the SDP offer if no encodings are given.\n\t\tif (!encodings)\n\t\t{\n\t\t\tsendingRtpParameters.encodings =\n\t\t\t\tsdpUnifiedPlanUtils.getRtpEncodings({ offerMediaObject });\n\t\t}\n\t\t// Set RTP encodings by parsing the SDP offer and complete them with given\n\t\t// one if just a single encoding has been given.\n\t\telse if (encodings.length === 1)\n\t\t{\n\t\t\tconst newEncodings =\n\t\t\t\tsdpUnifiedPlanUtils.getRtpEncodings({ offerMediaObject });\n\n\t\t\tObject.assign(newEncodings[0], encodings[0]);\n\n\t\t\tsendingRtpParameters.encodings = newEncodings;\n\t\t}\n\t\t// Otherwise if more than 1 encoding are given use them verbatim (but\n\t\t// reverse them back since we reversed them above to satisfy Firefox).\n\t\telse\n\t\t{\n\t\t\tsendingRtpParameters.encodings = encodings.reverse();\n\t\t}\n\n\t\t// If VP8 or H264 and there is effective simulcast, add scalabilityMode to\n\t\t// each encoding.\n\t\tif (\n\t\t\tsendingRtpParameters.encodings.length > 1 &&\n\t\t\t(\n\t\t\t\tsendingRtpParameters.codecs[0].mimeType.toLowerCase() === 'video/vp8' ||\n\t\t\t\tsendingRtpParameters.codecs[0].mimeType.toLowerCase() === 'video/h264'\n\t\t\t)\n\t\t)\n\t\t{\n\t\t\tfor (const encoding of sendingRtpParameters.encodings)\n\t\t\t{\n\t\t\t\tencoding.scalabilityMode = 'S1T3';\n\t\t\t}\n\t\t}\n\n\t\tthis._remoteSdp!.send(\n\t\t\t{\n\t\t\t\tofferMediaObject,\n\t\t\t\tofferRtpParameters  : sendingRtpParameters,\n\t\t\t\tanswerRtpParameters : sendingRemoteRtpParameters,\n\t\t\t\tcodecOptions,\n\t\t\t\textmapAllowMixed    : true\n\t\t\t});\n\n\t\tconst answer = { type: 'answer', sdp: this._remoteSdp!.getSdp() };\n\n\t\tlogger.debug(\n\t\t\t'send() | calling pc.setRemoteDescription() [answer:%o]',\n\t\t\tanswer);\n\n\t\tawait this._pc.setRemoteDescription(answer);\n\n\t\t// Store in the map.\n\t\tthis._mapMidTransceiver.set(localId, transceiver);\n\n\t\treturn {\n\t\t\tlocalId,\n\t\t\trtpParameters : sendingRtpParameters,\n\t\t\trtpSender     : transceiver.sender\n\t\t};\n\t}\n\n\tasync stopSending(localId: string): Promise<void>\n\t{\n\t\tlogger.debug('stopSending() [localId:%s]', localId);\n\n\t\tconst transceiver = this._mapMidTransceiver.get(localId);\n\n\t\tif (!transceiver)\n\t\t\tthrow new Error('associated transceiver not found');\n\n\t\ttransceiver.sender.replaceTrack(null);\n\t\tthis._pc.removeTrack(transceiver.sender);\n\t\t// NOTE: Cannot use closeMediaSection() due to the the note above in send()\n\t\t// method.\n\t\t// this._remoteSdp!.closeMediaSection(transceiver.mid);\n\t\tthis._remoteSdp!.disableMediaSection(transceiver.mid!);\n\n\t\tconst offer = await this._pc.createOffer();\n\n\t\tlogger.debug(\n\t\t\t'stopSending() | calling pc.setLocalDescription() [offer:%o]',\n\t\t\toffer);\n\n\t\tawait this._pc.setLocalDescription(offer);\n\n\t\tconst answer = { type: 'answer', sdp: this._remoteSdp!.getSdp() };\n\n\t\tlogger.debug(\n\t\t\t'stopSending() | calling pc.setRemoteDescription() [answer:%o]',\n\t\t\tanswer);\n\n\t\tawait this._pc.setRemoteDescription(answer);\n\t}\n\n\tasync replaceTrack(\n\t\tlocalId: string, track: MediaStreamTrack | null\n\t): Promise<void>\n\t{\n\t\tthis._assertSendDirection();\n\n\t\tif (track)\n\t\t{\n\t\t\tlogger.debug(\n\t\t\t\t'replaceTrack() [localId:%s, track.id:%s]', localId, track.id);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tlogger.debug('replaceTrack() [localId:%s, no track]', localId);\n\t\t}\n\n\t\tconst transceiver = this._mapMidTransceiver.get(localId);\n\n\t\tif (!transceiver)\n\t\t\tthrow new Error('associated RTCRtpTransceiver not found');\n\n\t\tawait transceiver.sender.replaceTrack(track);\n\t}\n\n\tasync setMaxSpatialLayer(localId: string, spatialLayer: number): Promise<void>\n\t{\n\t\tthis._assertSendDirection();\n\n\t\tlogger.debug(\n\t\t\t'setMaxSpatialLayer() [localId:%s, spatialLayer:%s]',\n\t\t\tlocalId, spatialLayer);\n\n\t\tconst transceiver = this._mapMidTransceiver.get(localId);\n\n\t\tif (!transceiver)\n\t\t\tthrow new Error('associated transceiver not found');\n\n\t\tconst parameters = transceiver.sender.getParameters();\n\n\t\t// NOTE: We require encodings given from low to high, however Firefox\n\t\t// requires them in reverse order, so do magic here.\n\t\tspatialLayer = parameters.encodings.length - 1 - spatialLayer;\n\n\t\tparameters.encodings.forEach((encoding: RTCRtpEncodingParameters, idx: number) =>\n\t\t{\n\t\t\tif (idx >= spatialLayer)\n\t\t\t\tencoding.active = true;\n\t\t\telse\n\t\t\t\tencoding.active = false;\n\t\t});\n\n\t\tawait transceiver.sender.setParameters(parameters);\n\t}\n\n\tasync setRtpEncodingParameters(localId: string, params: any): Promise<void>\n\t{\n\t\tthis._assertSendDirection();\n\n\t\tlogger.debug(\n\t\t\t'setRtpEncodingParameters() [localId:%s, params:%o]',\n\t\t\tlocalId, params);\n\n\t\tconst transceiver = this._mapMidTransceiver.get(localId);\n\n\t\tif (!transceiver)\n\t\t\tthrow new Error('associated RTCRtpTransceiver not found');\n\n\t\tconst parameters = transceiver.sender.getParameters();\n\n\t\tparameters.encodings.forEach((encoding: RTCRtpEncodingParameters, idx: number) =>\n\t\t{\n\t\t\tparameters.encodings[idx] = { ...encoding, ...params };\n\t\t});\n\n\t\tawait transceiver.sender.setParameters(parameters);\n\t}\n\n\tasync getSenderStats(localId: string): Promise<RTCStatsReport>\n\t{\n\t\tthis._assertSendDirection();\n\n\t\tconst transceiver = this._mapMidTransceiver.get(localId);\n\n\t\tif (!transceiver)\n\t\t\tthrow new Error('associated RTCRtpTransceiver not found');\n\n\t\treturn transceiver.sender.getStats();\n\t}\n\n\tasync sendDataChannel(\n\t\t{\n\t\t\tordered,\n\t\t\tmaxPacketLifeTime,\n\t\t\tmaxRetransmits,\n\t\t\tlabel,\n\t\t\tprotocol,\n\t\t\tpriority\n\t\t}: HandlerSendDataChannelOptions\n\t): Promise<HandlerSendDataChannelResult>\n\t{\n\t\tthis._assertSendDirection();\n\n\t\tconst options =\n\t\t{\n\t\t\tnegotiated : true,\n\t\t\tid         : this._nextSendSctpStreamId,\n\t\t\tordered,\n\t\t\tmaxPacketLifeTime,\n\t\t\tmaxRetransmits,\n\t\t\tprotocol,\n\t\t\tpriority\n\t\t};\n\n\t\tlogger.debug('sendDataChannel() [options:%o]', options);\n\n\t\tconst dataChannel = this._pc.createDataChannel(label, options);\n\n\t\t// Increase next id.\n\t\tthis._nextSendSctpStreamId =\n\t\t\t++this._nextSendSctpStreamId % SCTP_NUM_STREAMS.MIS;\n\n\t\t// If this is the first DataChannel we need to create the SDP answer with\n\t\t// m=application section.\n\t\tif (!this._hasDataChannelMediaSection)\n\t\t{\n\t\t\tconst offer = await this._pc.createOffer();\n\t\t\tconst localSdpObject = sdpTransform.parse(offer.sdp);\n\t\t\tconst offerMediaObject = localSdpObject.media\n\t\t\t\t.find((m: any) => m.type === 'application');\n\n\t\t\tif (!this._transportReady)\n\t\t\t\tawait this._setupTransport({ localDtlsRole: 'server', localSdpObject });\n\n\t\t\tlogger.debug(\n\t\t\t\t'sendDataChannel() | calling pc.setLocalDescription() [offer:%o]',\n\t\t\t\toffer);\n\n\t\t\tawait this._pc.setLocalDescription(offer);\n\n\t\t\tthis._remoteSdp!.sendSctpAssociation({ offerMediaObject });\n\n\t\t\tconst answer = { type: 'answer', sdp: this._remoteSdp!.getSdp() };\n\n\t\t\tlogger.debug(\n\t\t\t\t'sendDataChannel() | calling pc.setRemoteDescription() [answer:%o]',\n\t\t\t\tanswer);\n\n\t\t\tawait this._pc.setRemoteDescription(answer);\n\n\t\t\tthis._hasDataChannelMediaSection = true;\n\t\t}\n\n\t\tconst sctpStreamParameters: SctpStreamParameters =\n\t\t{\n\t\t\tstreamId          : options.id,\n\t\t\tordered           : options.ordered,\n\t\t\tmaxPacketLifeTime : options.maxPacketLifeTime,\n\t\t\tmaxRetransmits    : options.maxRetransmits\n\t\t};\n\n\t\treturn { dataChannel, sctpStreamParameters };\n\t}\n\n\tasync receive(\n\t\t{ trackId, kind, rtpParameters }: HandlerReceiveOptions\n\t): Promise<HandlerReceiveResult>\n\t{\n\t\tthis._assertRecvDirection();\n\n\t\tlogger.debug('receive() [trackId:%s, kind:%s]', trackId, kind);\n\n\t\tconst localId = rtpParameters.mid || String(this._mapMidTransceiver.size);\n\n\t\tthis._remoteSdp!.receive(\n\t\t\t{\n\t\t\t\tmid                : localId,\n\t\t\t\tkind,\n\t\t\t\tofferRtpParameters : rtpParameters,\n\t\t\t\tstreamId           : rtpParameters.rtcp!.cname!,\n\t\t\t\ttrackId\n\t\t\t});\n\n\t\tconst offer = { type: 'offer', sdp: this._remoteSdp!.getSdp() };\n\n\t\tlogger.debug(\n\t\t\t'receive() | calling pc.setRemoteDescription() [offer:%o]',\n\t\t\toffer);\n\n\t\tawait this._pc.setRemoteDescription(offer);\n\n\t\tlet answer = await this._pc.createAnswer();\n\t\tconst localSdpObject = sdpTransform.parse(answer.sdp);\n\t\tconst answerMediaObject = localSdpObject.media\n\t\t\t.find((m: any) => String(m.mid) === localId);\n\n\t\t// May need to modify codec parameters in the answer based on codec\n\t\t// parameters in the offer.\n\t\tsdpCommonUtils.applyCodecParameters(\n\t\t\t{\n\t\t\t\tofferRtpParameters : rtpParameters,\n\t\t\t\tanswerMediaObject\n\t\t\t});\n\n\t\tanswer = { type: 'answer', sdp: sdpTransform.write(localSdpObject) };\n\n\t\tif (!this._transportReady)\n\t\t\tawait this._setupTransport({ localDtlsRole: 'client', localSdpObject });\n\n\t\tlogger.debug(\n\t\t\t'receive() | calling pc.setLocalDescription() [answer:%o]',\n\t\t\tanswer);\n\n\t\tawait this._pc.setLocalDescription(answer);\n\n\t\tconst transceiver = this._pc.getTransceivers()\n\t\t\t.find((t: RTCRtpTransceiver) => t.mid === localId);\n\n\t\tif (!transceiver)\n\t\t\tthrow new Error('new RTCRtpTransceiver not found');\n\n\t\t// Store in the map.\n\t\tthis._mapMidTransceiver.set(localId, transceiver);\n\n\t\treturn {\n\t\t\tlocalId,\n\t\t\ttrack       : transceiver.receiver.track,\n\t\t\trtpReceiver : transceiver.receiver\n\t\t};\n\t}\n\n\tasync stopReceiving(localId: string): Promise<void>\n\t{\n\t\tthis._assertRecvDirection();\n\n\t\tlogger.debug('stopReceiving() [localId:%s]', localId);\n\n\t\tconst transceiver = this._mapMidTransceiver.get(localId);\n\n\t\tif (!transceiver)\n\t\t\tthrow new Error('associated RTCRtpTransceiver not found');\n\n\t\tthis._remoteSdp!.closeMediaSection(transceiver.mid!);\n\n\t\tconst offer = { type: 'offer', sdp: this._remoteSdp!.getSdp() };\n\n\t\tlogger.debug(\n\t\t\t'stopReceiving() | calling pc.setRemoteDescription() [offer:%o]',\n\t\t\toffer);\n\n\t\tawait this._pc.setRemoteDescription(offer);\n\n\t\tconst answer = await this._pc.createAnswer();\n\n\t\tlogger.debug(\n\t\t\t'stopReceiving() | calling pc.setLocalDescription() [answer:%o]',\n\t\t\tanswer);\n\n\t\tawait this._pc.setLocalDescription(answer);\n\t}\n\n\tasync getReceiverStats(localId: string): Promise<RTCStatsReport>\n\t{\n\t\tthis._assertRecvDirection();\n\n\t\tconst transceiver = this._mapMidTransceiver.get(localId);\n\n\t\tif (!transceiver)\n\t\t\tthrow new Error('associated RTCRtpTransceiver not found');\n\n\t\treturn transceiver.receiver.getStats();\n\t}\n\n\tasync receiveDataChannel(\n\t\t{ sctpStreamParameters, label, protocol }: HandlerReceiveDataChannelOptions\n\t): Promise<HandlerReceiveDataChannelResult>\n\t{\n\t\tthis._assertRecvDirection();\n\n\t\tconst {\n\t\t\tstreamId,\n\t\t\tordered,\n\t\t\tmaxPacketLifeTime,\n\t\t\tmaxRetransmits\n\t\t}: SctpStreamParameters = sctpStreamParameters;\n\n\t\tconst options =\n\t\t{\n\t\t\tnegotiated : true,\n\t\t\tid         : streamId,\n\t\t\tordered,\n\t\t\tmaxPacketLifeTime,\n\t\t\tmaxRetransmits,\n\t\t\tprotocol\n\t\t};\n\n\t\tlogger.debug('receiveDataChannel() [options:%o]', options);\n\n\t\tconst dataChannel = this._pc.createDataChannel(label, options);\n\n\t\t// If this is the first DataChannel we need to create the SDP offer with\n\t\t// m=application section.\n\t\tif (!this._hasDataChannelMediaSection)\n\t\t{\n\t\t\tthis._remoteSdp!.receiveSctpAssociation();\n\n\t\t\tconst offer = { type: 'offer', sdp: this._remoteSdp!.getSdp() };\n\n\t\t\tlogger.debug(\n\t\t\t\t'receiveDataChannel() | calling pc.setRemoteDescription() [offer:%o]',\n\t\t\t\toffer);\n\n\t\t\tawait this._pc.setRemoteDescription(offer);\n\n\t\t\tconst answer = await this._pc.createAnswer();\n\n\t\t\tif (!this._transportReady)\n\t\t\t{\n\t\t\t\tconst localSdpObject = sdpTransform.parse(answer.sdp);\n\n\t\t\t\tawait this._setupTransport({ localDtlsRole: 'client', localSdpObject });\n\t\t\t}\n\n\t\t\tlogger.debug(\n\t\t\t\t'receiveDataChannel() | calling pc.setRemoteDescription() [answer:%o]',\n\t\t\t\tanswer);\n\n\t\t\tawait this._pc.setLocalDescription(answer);\n\n\t\t\tthis._hasDataChannelMediaSection = true;\n\t\t}\n\n\t\treturn { dataChannel };\n\t}\n\n\tprivate async _setupTransport(\n\t\t{\n\t\t\tlocalDtlsRole,\n\t\t\tlocalSdpObject\n\t\t}:\n\t\t{\n\t\t\tlocalDtlsRole: DtlsRole;\n\t\t\tlocalSdpObject?: any;\n\t\t}\n\t): Promise<void>\n\t{\n\t\tif (!localSdpObject)\n\t\t\tlocalSdpObject = sdpTransform.parse(this._pc.localDescription.sdp);\n\n\t\t// Get our local DTLS parameters.\n\t\tconst dtlsParameters =\n\t\t\tsdpCommonUtils.extractDtlsParameters({ sdpObject: localSdpObject });\n\n\t\t// Set our DTLS role.\n\t\tdtlsParameters.role = localDtlsRole;\n\n\t\t// Update the remote DTLS role in the SDP.\n\t\tthis._remoteSdp!.updateDtlsRole(\n\t\t\tlocalDtlsRole === 'client' ? 'server' : 'client');\n\n\t\t// Need to tell the remote transport about our parameters.\n\t\tawait this.safeEmitAsPromise('@connect', { dtlsParameters });\n\n\t\tthis._transportReady = true;\n\t}\n\n\tprivate _assertSendDirection(): void\n\t{\n\t\tif (this._direction !== 'send')\n\t\t{\n\t\t\tthrow new Error(\n\t\t\t\t'method can just be called for handlers with \"send\" direction');\n\t\t}\n\t}\n\n\tprivate _assertRecvDirection(): void\n\t{\n\t\tif (this._direction !== 'recv')\n\t\t{\n\t\t\tthrow new Error(\n\t\t\t\t'method can just be called for handlers with \"recv\" direction');\n\t\t}\n\t}\n}\n"]}