{"version":3,"file":"Device.js","sourceRoot":"","sources":["../src/Device.ts"],"names":[],"mappings":";AAAA,8BAA8B;;;;AAE9B,4DAA4B;AAC5B,qCAAkC;AAClC,iEAA8D;AAC9D,qCAA+D;AAC/D,uDAAiC;AACjC,qDAA+B;AAC/B,2CAA4E;AAE5E,kDAA+C;AAC/C,kDAA+C;AAC/C,kDAA+C;AAC/C,kDAA+C;AAC/C,oDAAiD;AACjD,kDAA+C;AAC/C,kDAA+C;AAC/C,8CAA2C;AAC3C,wDAAqD;AAGrD,8CAA2C;AAG3C,MAAM,MAAM,GAAG,IAAI,eAAM,CAAC,QAAQ,CAAC,CAAC;AAgDpC,SAAgB,YAAY;IAE3B,gBAAgB;IAChB,mDAAmD;IACnD,IAAI,OAAO,SAAS,KAAK,QAAQ,IAAI,SAAS,CAAC,OAAO,KAAK,aAAa,EACxE;QACC,IAAI,OAAO,iBAAiB,KAAK,WAAW,EAC5C;YACC,MAAM,CAAC,IAAI,CACV,0EAA0E,CAAC,CAAC;YAE7E,OAAO,SAAS,CAAC;SACjB;QAED,MAAM,CAAC,KAAK,CAAC,mDAAmD,CAAC,CAAC;QAElE,OAAO,aAAa,CAAC;KACrB;IACD,WAAW;SACN,IAAI,OAAO,SAAS,KAAK,QAAQ,IAAI,OAAO,SAAS,CAAC,SAAS,KAAK,QAAQ,EACjF;QACC,MAAM,EAAE,GAAG,SAAS,CAAC,SAAS,CAAC;QAC/B,MAAM,OAAO,GAAG,gBAAM,CAAC,SAAS,CAAC,EAAE,CAAC,CAAC;QACrC,MAAM,MAAM,GAAG,OAAO,CAAC,SAAS,EAAE,CAAC;QAEnC,uBAAuB;QACvB,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,EAC3D;YACC,OAAO,UAAU,CAAC;SAClB;aACI,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,EAChE;YACC,OAAO,UAAU,CAAC;SAClB;aACI,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,EAChE;YACC,OAAO,UAAU,CAAC;SAClB;aACI,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,CAAC,EAChE;YACC,OAAO,UAAU,CAAC;SAClB;QACD,WAAW;aACN,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,OAAO,EAAE,MAAM,EAAE,CAAC,EAC/C;YACC,OAAO,WAAW,CAAC;SACnB;QACD,4CAA4C;aACvC,IACJ,OAAO,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,QAAQ,EAAE,CAAC;YACvC,OAAO,iBAAiB,KAAK,WAAW;YACxC,iBAAiB,CAAC,SAAS,CAAC,cAAc,CAAC,kBAAkB,CAAC,EAE/D;YACC,OAAO,UAAU,CAAC;SAClB;QACD,8BAA8B;aACzB,IAAI,OAAO,CAAC,SAAS,CAAC,EAAE,MAAM,EAAE,MAAM,EAAE,CAAC,EAC9C;YACC,OAAO,UAAU,CAAC;SAClB;QACD,8BAA8B;aACzB,IACJ,OAAO,CAAC,SAAS,CAAC,EAAE,gBAAgB,EAAE,MAAM,EAAE,CAAC;YAC/C,OAAO,CAAC,SAAS,CAAC,EAAE,gBAAgB,EAAE,MAAM,EAAE,CAAC,EAEhD;YACC,OAAO,QAAQ,CAAC;SAChB;QACD,2CAA2C;aACtC,IAAI,MAAM,CAAC,IAAI,IAAI,MAAM,CAAC,IAAI,CAAC,WAAW,EAAE,KAAK,OAAO,EAC7D;YACC,MAAM,KAAK,GAAG,EAAE,CAAC,KAAK,CAAC,mCAAmC,CAAC,CAAC;YAE5D,IAAI,KAAK,EACT;gBACC,MAAM,OAAO,GAAG,MAAM,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,CAAC;gBAEjC,IAAI,OAAO,IAAI,EAAE,EACjB;oBACC,OAAO,UAAU,CAAC;iBAClB;qBACI,IAAI,OAAO,IAAI,EAAE,EACtB;oBACC,OAAO,UAAU,CAAC;iBAClB;qBACI,IAAI,OAAO,IAAI,EAAE,EACtB;oBACC,OAAO,UAAU,CAAC;iBAClB;qBAED;oBACC,OAAO,UAAU,CAAC;iBAClB;aACD;iBAED;gBACC,OAAO,UAAU,CAAC;aAClB;SACD;QACD,uBAAuB;aAEvB;YACC,MAAM,CAAC,IAAI,CACV,oEAAoE,EACpE,OAAO,CAAC,cAAc,EAAE,EAAE,OAAO,CAAC,iBAAiB,EAAE,CAAC,CAAC;YAExD,OAAO,SAAS,CAAC;SACjB;KACD;IACD,kBAAkB;SAElB;QACC,OAAO,QAAQ,CAAC;KAChB;AACF,CAAC;AAnHD,oCAmHC;AAED,MAAa,MAAM;IAoBlB;;;;OAIG;IACH,YAAY,qBAA2C,EACtD,EAAE,WAAW,EAAE,cAAc,EAAE,OAAO,KAAoB,EAAE;QApB7D,eAAe;QACP,YAAO,GAAG,KAAK,CAAC;QAUxB,qBAAqB;QACF,cAAS,GAAG,IAAI,2CAAoB,EAAE,CAAC;QAUzD,MAAM,CAAC,KAAK,CAAC,eAAe,CAAC,CAAC;QAE9B,4BAA4B;QAC5B,IAAI,OAAO,EACX;YACC,MAAM,CAAC,IAAI,CACV,yFAAyF,CAAC,CAAC;YAE5F,IAAI,OAAO,OAAO,KAAK,QAAQ;gBAC9B,WAAW,GAAG,OAA6B,CAAC;;gBAE5C,MAAM,IAAI,SAAS,CAClB,2EAA2E,CAAC,CAAC;SAC/E;QAED,IAAI,WAAW,IAAI,cAAc,EACjC;YACC,MAAM,IAAI,SAAS,CAClB,0DAA0D,CAAC,CAAC;SAC7D;QAED,IAAI,cAAc,EAClB;YACC,IAAI,CAAC,eAAe,GAAG,cAAc,CAAC;SACtC;aAED;YACC,IAAI,WAAW,EACf;gBACC,MAAM,CAAC,KAAK,CAAC,mCAAmC,EAAE,WAAW,CAAC,CAAC;aAC/D;iBAED;gBACC,WAAW,GAAG,YAAY,EAAE,CAAC;gBAE7B,IAAI,WAAW;oBACd,MAAM,CAAC,KAAK,CAAC,sCAAsC,EAAE,WAAW,CAAC,CAAC;;oBAElE,MAAM,IAAI,yBAAgB,CAAC,sBAAsB,CAAC,CAAC;aACpD;YAED,QAAQ,WAAW,EACnB;gBACC,KAAK,UAAU;oBACd,IAAI,CAAC,eAAe,GAAG,mBAAQ,CAAC,aAAa,EAAE,CAAC;oBAChD,MAAM;gBACP,KAAK,UAAU;oBACd,IAAI,CAAC,eAAe,GAAG,mBAAQ,CAAC,aAAa,EAAE,CAAC;oBAChD,MAAM;gBACP,KAAK,UAAU;oBACd,IAAI,CAAC,eAAe,GAAG,mBAAQ,CAAC,aAAa,EAAE,CAAC;oBAChD,MAAM;gBACP,KAAK,UAAU;oBACd,IAAI,CAAC,eAAe,GAAG,mBAAQ,CAAC,aAAa,EAAE,CAAC;oBAChD,MAAM;gBACP,KAAK,WAAW;oBACf,IAAI,CAAC,eAAe,GAAG,qBAAS,CAAC,aAAa,EAAE,CAAC;oBACjD,MAAM;gBACP,KAAK,UAAU;oBACd,IAAI,CAAC,eAAe,GAAG,mBAAQ,CAAC,aAAa,EAAE,CAAC;oBAChD,MAAM;gBACP,KAAK,UAAU;oBACd,IAAI,CAAC,eAAe,GAAG,mBAAQ,CAAC,aAAa,EAAE,CAAC;oBAChD,MAAM;gBACP,KAAK,QAAQ;oBACZ,IAAI,CAAC,eAAe,GAAG,eAAM,CAAC,aAAa,EAAE,CAAC;oBAC9C,MAAM;gBACP,KAAK,aAAa;oBACjB,IAAI,CAAC,eAAe,GAAG,yBAAW,CAAC,aAAa,EAAE,CAAC;oBACnD,MAAM;gBACP,KAAK,QAAQ;oBACZ,IAAI,CAAC,eAAe,GAAG,eAAM,CAAC,aAAa,CAAC,qBAAqB,CAAQ,CAAC;oBAC1E,MAAM;gBACP;oBACC,MAAM,IAAI,SAAS,CAAC,wBAAwB,WAAW,GAAG,CAAC,CAAC;aAC7D;SACD;QAED,6CAA6C;QAC7C,MAAM,OAAO,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;QAEvC,IAAI,CAAC,YAAY,GAAG,OAAO,CAAC,IAAI,CAAC;QAEjC,OAAO,CAAC,KAAK,EAAE,CAAC;QAEhB,IAAI,CAAC,wBAAwB,GAAG,SAAS,CAAC;QAC1C,IAAI,CAAC,oBAAoB,GAAG,SAAS,CAAC;QACtC,IAAI,CAAC,iBAAiB;YACtB;gBACC,KAAK,EAAG,KAAK;gBACb,KAAK,EAAG,KAAK;aACb,CAAC;QACF,IAAI,CAAC,iBAAiB,GAAG,SAAS,CAAC;IACpC,CAAC;IAED;;OAEG;IACH,IAAI,WAAW;QAEd,OAAO,IAAI,CAAC,YAAY,CAAC;IAC1B,CAAC;IAED;;OAEG;IACH,IAAI,MAAM;QAET,OAAO,IAAI,CAAC,OAAO,CAAC;IACrB,CAAC;IAED;;;;OAIG;IACH,IAAI,eAAe;QAElB,IAAI,CAAC,IAAI,CAAC,OAAO;YAChB,MAAM,IAAI,0BAAiB,CAAC,YAAY,CAAC,CAAC;QAE3C,OAAO,IAAI,CAAC,oBAAqB,CAAC;IACnC,CAAC;IAED;;;;OAIG;IACH,IAAI,gBAAgB;QAEnB,IAAI,CAAC,IAAI,CAAC,OAAO;YAChB,MAAM,IAAI,0BAAiB,CAAC,YAAY,CAAC,CAAC;QAE3C,OAAO,IAAI,CAAC,iBAAkB,CAAC;IAChC,CAAC;IAED;;;;OAIG;IACH,IAAI,QAAQ;QAEX,OAAO,IAAI,CAAC,SAAS,CAAC;IACvB,CAAC;IAED;;OAEG;IACH,KAAK,CAAC,IAAI,CACT,EAAE,qBAAqB,EACmB;QAG1C,MAAM,CAAC,KAAK,CAAC,mCAAmC,EAAE,qBAAqB,CAAC,CAAC;QAEzE,qBAAqB,GAAG,KAAK,CAAC,KAAK,CAAC,qBAAqB,EAAE,SAAS,CAAC,CAAC;QAEtE,4CAA4C;QAC5C,IAAI,OAAqC,CAAC;QAE1C,IACA;YACC,IAAI,IAAI,CAAC,OAAO;gBACf,MAAM,IAAI,0BAAiB,CAAC,gBAAgB,CAAC,CAAC;YAE/C,kBAAkB;YAClB,IAAI,CAAC,uBAAuB,CAAC,qBAAqB,CAAC,CAAC;YAEpD,OAAO,GAAG,IAAI,CAAC,eAAe,EAAE,CAAC;YAEjC,MAAM,qBAAqB,GAAG,MAAM,OAAO,CAAC,wBAAwB,EAAE,CAAC;YAEvE,MAAM,CAAC,KAAK,CACX,yCAAyC,EAAE,qBAAqB,CAAC,CAAC;YAEnE,kBAAkB;YAClB,IAAI,CAAC,uBAAuB,CAAC,qBAAqB,CAAC,CAAC;YAEpD,iCAAiC;YACjC,IAAI,CAAC,wBAAwB,GAAG,IAAI,CAAC,0BAA0B,CAC9D,qBAAqB,EAAE,qBAAqB,CAAC,CAAC;YAE/C,MAAM,CAAC,KAAK,CACX,2CAA2C,EAC3C,IAAI,CAAC,wBAAwB,CAAC,CAAC;YAEhC,4CAA4C;YAC5C,IAAI,CAAC,iBAAiB,CAAC,KAAK;gBAC3B,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,wBAAwB,CAAC,CAAC;YACtD,IAAI,CAAC,iBAAiB,CAAC,KAAK;gBAC3B,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,IAAI,CAAC,wBAAwB,CAAC,CAAC;YAEtD,+DAA+D;YAC/D,IAAI,CAAC,oBAAoB;gBACxB,IAAI,CAAC,sBAAsB,CAAC,IAAI,CAAC,wBAAwB,CAAC,CAAC;YAE5D,kBAAkB;YAClB,IAAI,CAAC,uBAAuB,CAAC,IAAI,CAAC,oBAAoB,CAAC,CAAC;YAExD,MAAM,CAAC,KAAK,CACX,4CAA4C,EAC5C,IAAI,CAAC,oBAAoB,CAAC,CAAC;YAE5B,kCAAkC;YAClC,IAAI,CAAC,iBAAiB,GAAG,MAAM,OAAO,CAAC,yBAAyB,EAAE,CAAC;YAEnE,MAAM,CAAC,KAAK,CACX,0CAA0C,EAAE,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAErE,kBAAkB;YAClB,IAAI,CAAC,wBAAwB,CAAC,IAAI,CAAC,iBAAiB,CAAC,CAAC;YAEtD,MAAM,CAAC,KAAK,CAAC,kBAAkB,CAAC,CAAC;YAEjC,IAAI,CAAC,OAAO,GAAG,IAAI,CAAC;YAEpB,OAAO,CAAC,KAAK,EAAE,CAAC;SAChB;QACD,OAAO,KAAK,EACZ;YACC,IAAI,OAAO;gBACV,OAAO,CAAC,KAAK,EAAE,CAAC;YAEjB,MAAM,KAAK,CAAC;SACZ;IACF,CAAC;IAED;;;;;OAKG;IACH,UAAU,CAAC,IAAe;QAEzB,IAAI,CAAC,IAAI,CAAC,OAAO;YAChB,MAAM,IAAI,0BAAiB,CAAC,YAAY,CAAC,CAAC;aACtC,IAAI,IAAI,KAAK,OAAO,IAAI,IAAI,KAAK,OAAO;YAC5C,MAAM,IAAI,SAAS,CAAC,iBAAiB,IAAI,GAAG,CAAC,CAAC;QAE/C,OAAO,IAAI,CAAC,iBAAiB,CAAC,IAAI,CAAC,CAAC;IACrC,CAAC;IAED;;;;;OAKG;IACH,mBAAmB,CAClB,EACC,EAAE,EACF,aAAa,EACb,aAAa,EACb,cAAc,EACd,cAAc,EACd,UAAU,EACV,kBAAkB,EAClB,kBAAkB,EAClB,sBAAsB,EACtB,OAAO,GAAG,EAAE,EACM;QAGnB,MAAM,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;QAEtC,OAAO,IAAI,CAAC,gBAAgB,CAC3B;YACC,SAAS,EAAgB,MAAM;YAC/B,EAAE,EAAuB,EAAE;YAC3B,aAAa,EAAY,aAAa;YACtC,aAAa,EAAY,aAAa;YACtC,cAAc,EAAW,cAAc;YACvC,cAAc,EAAW,cAAc;YACvC,UAAU,EAAe,UAAU;YACnC,kBAAkB,EAAO,kBAAkB;YAC3C,kBAAkB,EAAO,kBAAkB;YAC3C,sBAAsB,EAAG,sBAAsB;YAC/C,OAAO,EAAkB,OAAO;SAChC,CAAC,CAAC;IACL,CAAC;IAED;;;;;OAKG;IACH,mBAAmB,CAClB,EACC,EAAE,EACF,aAAa,EACb,aAAa,EACb,cAAc,EACd,cAAc,EACd,UAAU,EACV,kBAAkB,EAClB,kBAAkB,EAClB,sBAAsB,EACtB,OAAO,GAAG,EAAE,EACM;QAGnB,MAAM,CAAC,KAAK,CAAC,uBAAuB,CAAC,CAAC;QAEtC,OAAO,IAAI,CAAC,gBAAgB,CAC3B;YACC,SAAS,EAAgB,MAAM;YAC/B,EAAE,EAAuB,EAAE;YAC3B,aAAa,EAAY,aAAa;YACtC,aAAa,EAAY,aAAa;YACtC,cAAc,EAAW,cAAc;YACvC,cAAc,EAAW,cAAc;YACvC,UAAU,EAAe,UAAU;YACnC,kBAAkB,EAAO,kBAAkB;YAC3C,kBAAkB,EAAO,kBAAkB;YAC3C,sBAAsB,EAAG,sBAAsB;YAC/C,OAAO,EAAkB,OAAO;SAChC,CAAC,CAAC;IACL,CAAC;IAEO,gBAAgB,CACvB,EACC,SAAS,EACT,EAAE,EACF,aAAa,EACb,aAAa,EACb,cAAc,EACd,cAAc,EACd,UAAU,EACV,kBAAkB,EAClB,kBAAkB,EAClB,sBAAsB,EACtB,OAAO,GAAG,EAAE,EACc;QAG3B,IAAI,CAAC,IAAI,CAAC,OAAO;YAChB,MAAM,IAAI,0BAAiB,CAAC,YAAY,CAAC,CAAC;aACtC,IAAI,OAAO,EAAE,KAAK,QAAQ;YAC9B,MAAM,IAAI,SAAS,CAAC,YAAY,CAAC,CAAC;aAC9B,IAAI,OAAO,aAAa,KAAK,QAAQ;YACzC,MAAM,IAAI,SAAS,CAAC,uBAAuB,CAAC,CAAC;aACzC,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,aAAa,CAAC;YACrC,MAAM,IAAI,SAAS,CAAC,uBAAuB,CAAC,CAAC;aACzC,IAAI,OAAO,cAAc,KAAK,QAAQ;YAC1C,MAAM,IAAI,SAAS,CAAC,wBAAwB,CAAC,CAAC;aAC1C,IAAI,cAAc,IAAI,OAAO,cAAc,KAAK,QAAQ;YAC5D,MAAM,IAAI,SAAS,CAAC,sBAAsB,CAAC,CAAC;aACxC,IAAI,OAAO,IAAI,OAAO,OAAO,KAAK,QAAQ;YAC9C,MAAM,IAAI,SAAS,CAAC,qCAAqC,CAAC,CAAC;QAE5D,0BAA0B;QAC1B,MAAM,SAAS,GAAG,IAAI,qBAAS,CAC9B;YACC,SAAS;YACT,EAAE;YACF,aAAa;YACb,aAAa;YACb,cAAc;YACd,cAAc;YACd,UAAU;YACV,kBAAkB;YAClB,kBAAkB;YAClB,sBAAsB;YACtB,OAAO;YACP,cAAc,EAAY,IAAI,CAAC,eAAe;YAC9C,uBAAuB,EAAG,IAAI,CAAC,wBAAwB;YACvD,gBAAgB,EAAU,IAAI,CAAC,iBAAiB;SAChD,CAAC,CAAC;QAEJ,uBAAuB;QACvB,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,cAAc,EAAE,SAAS,CAAC,CAAC;QAEnD,OAAO,SAAS,CAAC;IAClB,CAAC;CACD;AAtZD,wBAsZC","sourcesContent":["/* global RTCRtpTransceiver */\n\nimport Bowser from 'bowser';\nimport { Logger } from './Logger';\nimport { EnhancedEventEmitter } from './EnhancedEventEmitter';\nimport { UnsupportedError, InvalidStateError } from './errors';\nimport * as utils from './utils';\nimport * as ortc from './ortc';\nimport { Transport, TransportOptions, CanProduceByKind } from './Transport';\nimport { HandlerFactory, HandlerInterface } from './handlers/HandlerInterface';\nimport { Chrome74 } from './handlers/Chrome74';\nimport { Chrome70 } from './handlers/Chrome70';\nimport { Chrome67 } from './handlers/Chrome67';\nimport { Chrome55 } from './handlers/Chrome55';\nimport { Firefox60 } from './handlers/Firefox60';\nimport { Safari12 } from './handlers/Safari12';\nimport { Safari11 } from './handlers/Safari11';\nimport { Edge11 } from './handlers/Edge11';\nimport { ReactNative } from './handlers/ReactNative';\nimport { RtpCapabilities, MediaKind } from './RtpParameters';\nimport { SctpCapabilities } from './SctpParameters';\nimport { Werift } from './handlers/werift';\nimport { RTCRtpCodecParameters, RTCRtpHeaderExtensionParameters } from 'werift';\n\nconst logger = new Logger('Device');\n\nexport type BuiltinHandlerName =\n\t| 'Chrome74'\n\t| 'Chrome70'\n\t| 'Chrome67'\n\t| 'Chrome55'\n\t| 'Firefox60'\n\t| 'Safari12'\n\t| 'Safari11'\n\t| 'Edge11'\n\t| 'ReactNative'\n\t| 'werift'\n\nexport type DeviceOptions =\n{\n\t/**\n\t * The name of one of the builtin handlers.\n\t */\n\thandlerName?: BuiltinHandlerName;\n\t/**\n\t * Custom handler factory.\n\t */\n\thandlerFactory?: HandlerFactory;\n\t/**\n\t * DEPRECATED!\n\t * The name of one of the builtin handlers.\n\t */\n\tHandler?: string;\n};\n\ninterface InternalTransportOptions extends TransportOptions\n{\n\tdirection: 'send' | 'recv';\n}\n\nexport interface WeriftRtpCapabilities\n{\n\tcodecs: Partial<{\n\t\taudio: RTCRtpCodecParameters[];\n\t\tvideo: RTCRtpCodecParameters[];\n\t}>;\n\theaderExtensions: Partial<{\n\t\taudio: RTCRtpHeaderExtensionParameters[];\n\t\tvideo: RTCRtpHeaderExtensionParameters[];\n\t}>;\n}\n\nexport function detectDevice(): BuiltinHandlerName | undefined\n{\n\t// React-Native.\n\t// NOTE: react-native-webrtc >= 1.75.0 is required.\n\tif (typeof navigator === 'object' && navigator.product === 'ReactNative')\n\t{\n\t\tif (typeof RTCPeerConnection === 'undefined')\n\t\t{\n\t\t\tlogger.warn(\n\t\t\t\t'this._detectDevice() | unsupported ReactNative without RTCPeerConnection');\n\n\t\t\treturn undefined;\n\t\t}\n\n\t\tlogger.debug('this._detectDevice() | ReactNative handler chosen');\n\n\t\treturn 'ReactNative';\n\t}\n\t// Browser.\n\telse if (typeof navigator === 'object' && typeof navigator.userAgent === 'string')\n\t{\n\t\tconst ua = navigator.userAgent;\n\t\tconst browser = Bowser.getParser(ua);\n\t\tconst engine = browser.getEngine();\n\n\t\t// Chrome and Chromium.\n\t\tif (browser.satisfies({ chrome: '>=74', chromium: '>=74' }))\n\t\t{\n\t\t\treturn 'Chrome74';\n\t\t}\n\t\telse if (browser.satisfies({ chrome: '>=70', chromium: '>=70' }))\n\t\t{\n\t\t\treturn 'Chrome70';\n\t\t}\n\t\telse if (browser.satisfies({ chrome: '>=67', chromium: '>=67' }))\n\t\t{\n\t\t\treturn 'Chrome67';\n\t\t}\n\t\telse if (browser.satisfies({ chrome: '>=55', chromium: '>=55' }))\n\t\t{\n\t\t\treturn 'Chrome55';\n\t\t}\n\t\t// Firefox.\n\t\telse if (browser.satisfies({ firefox: '>=60' }))\n\t\t{\n\t\t\treturn 'Firefox60';\n\t\t}\n\t\t// Safari with Unified-Plan support enabled.\n\t\telse if (\n\t\t\tbrowser.satisfies({ safari: '>=12.0' }) &&\n\t\t\ttypeof RTCRtpTransceiver !== 'undefined' &&\n\t\t\tRTCRtpTransceiver.prototype.hasOwnProperty('currentDirection')\n\t\t)\n\t\t{\n\t\t\treturn 'Safari12';\n\t\t}\n\t\t// Safari with Plab-B support.\n\t\telse if (browser.satisfies({ safari: '>=11' }))\n\t\t{\n\t\t\treturn 'Safari11';\n\t\t}\n\t\t// Old Edge with ORTC support.\n\t\telse if (\n\t\t\tbrowser.satisfies({ 'microsoft edge': '>=11' }) &&\n\t\t\tbrowser.satisfies({ 'microsoft edge': '<=18' })\n\t\t)\n\t\t{\n\t\t\treturn 'Edge11';\n\t\t}\n\t\t// Best effort for Chromium based browsers.\n\t\telse if (engine.name && engine.name.toLowerCase() === 'blink')\n\t\t{\n\t\t\tconst match = ua.match(/(?:(?:Chrome|Chromium))[ /](\\w+)/i);\n\n\t\t\tif (match)\n\t\t\t{\n\t\t\t\tconst version = Number(match[1]);\n\n\t\t\t\tif (version >= 74)\n\t\t\t\t{\n\t\t\t\t\treturn 'Chrome74';\n\t\t\t\t}\n\t\t\t\telse if (version >= 70)\n\t\t\t\t{\n\t\t\t\t\treturn 'Chrome70';\n\t\t\t\t}\n\t\t\t\telse if (version >= 67)\n\t\t\t\t{\n\t\t\t\t\treturn 'Chrome67';\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\treturn 'Chrome55';\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn 'Chrome74';\n\t\t\t}\n\t\t}\n\t\t// Unsupported browser.\n\t\telse\n\t\t{\n\t\t\tlogger.warn(\n\t\t\t\t'this._detectDevice() | browser not supported [name:%s, version:%s]',\n\t\t\t\tbrowser.getBrowserName(), browser.getBrowserVersion());\n\n\t\t\treturn undefined;\n\t\t}\n\t}\n\t// Unknown device.\n\telse\n\t{\n\t\treturn 'werift';\n\t}\n}\n\nexport class Device\n{\n\t// RTC handler factory.\n\tprivate readonly _handlerFactory: HandlerFactory;\n\t// Handler name.\n\tprivate readonly _handlerName: string;\n\t// Loaded flag.\n\tprivate _loaded = false;\n\t// Extended RTP capabilities.\n\tprivate _extendedRtpCapabilities?: any;\n\t// Local RTP capabilities for receiving media.\n\tprivate _recvRtpCapabilities?: RtpCapabilities;\n\t// Whether we can produce audio/video based on computed extended RTP\n\t// capabilities.\n\tprivate readonly _canProduceByKind: CanProduceByKind;\n\t// Local SCTP capabilities.\n\tprivate _sctpCapabilities?: SctpCapabilities;\n\t// Observer instance.\n\tprotected readonly _observer = new EnhancedEventEmitter();\n\n\t/**\n\t * Create a new Device to connect to mediasoup server.\n\t *\n\t * @throws {UnsupportedError} if device is not supported.\n\t */\n\tconstructor(weriftRtpCapabilities:WeriftRtpCapabilities, \n\t\t{ handlerName, handlerFactory, Handler }: DeviceOptions = {})\n\t{\n\t\tlogger.debug('constructor()');\n\n\t\t// Handle deprecated option.\n\t\tif (Handler)\n\t\t{\n\t\t\tlogger.warn(\n\t\t\t\t'constructor() | Handler option is DEPRECATED, use handlerName or handlerFactory instead');\n\n\t\t\tif (typeof Handler === 'string')\n\t\t\t\thandlerName = Handler as BuiltinHandlerName;\n\t\t\telse\n\t\t\t\tthrow new TypeError(\n\t\t\t\t\t'non string Handler option no longer supported, use handlerFactory instead');\n\t\t}\n\n\t\tif (handlerName && handlerFactory)\n\t\t{\n\t\t\tthrow new TypeError(\n\t\t\t\t'just one of handlerName or handlerInterface can be given');\n\t\t}\n\n\t\tif (handlerFactory)\n\t\t{\n\t\t\tthis._handlerFactory = handlerFactory;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tif (handlerName)\n\t\t\t{\n\t\t\t\tlogger.debug('constructor() | handler given: %s', handlerName);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\thandlerName = detectDevice();\n\n\t\t\t\tif (handlerName)\n\t\t\t\t\tlogger.debug('constructor() | detected handler: %s', handlerName);\n\t\t\t\telse\n\t\t\t\t\tthrow new UnsupportedError('device not supported');\n\t\t\t}\n\n\t\t\tswitch (handlerName)\n\t\t\t{\n\t\t\t\tcase 'Chrome74':\n\t\t\t\t\tthis._handlerFactory = Chrome74.createFactory();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Chrome70':\n\t\t\t\t\tthis._handlerFactory = Chrome70.createFactory();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Chrome67':\n\t\t\t\t\tthis._handlerFactory = Chrome67.createFactory();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Chrome55':\n\t\t\t\t\tthis._handlerFactory = Chrome55.createFactory();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Firefox60':\n\t\t\t\t\tthis._handlerFactory = Firefox60.createFactory();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Safari12':\n\t\t\t\t\tthis._handlerFactory = Safari12.createFactory();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Safari11':\n\t\t\t\t\tthis._handlerFactory = Safari11.createFactory();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'Edge11':\n\t\t\t\t\tthis._handlerFactory = Edge11.createFactory();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'ReactNative':\n\t\t\t\t\tthis._handlerFactory = ReactNative.createFactory();\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'werift':\n\t\t\t\t\tthis._handlerFactory = Werift.createFactory(weriftRtpCapabilities) as any;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthrow new TypeError(`unknown handlerName \"${handlerName}\"`);\n\t\t\t}\n\t\t}\n\n\t\t// Create a temporal handler to get its name.\n\t\tconst handler = this._handlerFactory();\n\n\t\tthis._handlerName = handler.name;\n\n\t\thandler.close();\n\n\t\tthis._extendedRtpCapabilities = undefined;\n\t\tthis._recvRtpCapabilities = undefined;\n\t\tthis._canProduceByKind =\n\t\t{\n\t\t\taudio : false,\n\t\t\tvideo : false\n\t\t};\n\t\tthis._sctpCapabilities = undefined;\n\t}\n\n\t/**\n\t * The RTC handler name.\n\t */\n\tget handlerName(): string\n\t{\n\t\treturn this._handlerName;\n\t}\n\n\t/**\n\t * Whether the Device is loaded.\n\t */\n\tget loaded(): boolean\n\t{\n\t\treturn this._loaded;\n\t}\n\n\t/**\n\t * RTP capabilities of the Device for receiving media.\n\t *\n\t * @throws {InvalidStateError} if not loaded.\n\t */\n\tget rtpCapabilities(): RtpCapabilities\n\t{\n\t\tif (!this._loaded)\n\t\t\tthrow new InvalidStateError('not loaded');\n\n\t\treturn this._recvRtpCapabilities!;\n\t}\n\n\t/**\n\t * SCTP capabilities of the Device.\n\t *\n\t * @throws {InvalidStateError} if not loaded.\n\t */\n\tget sctpCapabilities(): SctpCapabilities\n\t{\n\t\tif (!this._loaded)\n\t\t\tthrow new InvalidStateError('not loaded');\n\n\t\treturn this._sctpCapabilities!;\n\t}\n\n\t/**\n\t * Observer.\n\t *\n\t * @emits newtransport - (transport: Transport)\n\t */\n\tget observer(): EnhancedEventEmitter\n\t{\n\t\treturn this._observer;\n\t}\n\n\t/**\n\t * Initialize the Device.\n\t */\n\tasync load(\n\t\t{ routerRtpCapabilities }:\n\t\t{ routerRtpCapabilities: RtpCapabilities }\n\t): Promise<void>\n\t{\n\t\tlogger.debug('load() [routerRtpCapabilities:%o]', routerRtpCapabilities);\n\n\t\trouterRtpCapabilities = utils.clone(routerRtpCapabilities, undefined);\n\n\t\t// Temporal handler to get its capabilities.\n\t\tlet handler: HandlerInterface | undefined;\n\n\t\ttry\n\t\t{\n\t\t\tif (this._loaded)\n\t\t\t\tthrow new InvalidStateError('already loaded');\n\n\t\t\t// This may throw.\n\t\t\tortc.validateRtpCapabilities(routerRtpCapabilities);\n\n\t\t\thandler = this._handlerFactory();\n\n\t\t\tconst nativeRtpCapabilities = await handler.getNativeRtpCapabilities();\n\n\t\t\tlogger.debug(\n\t\t\t\t'load() | got native RTP capabilities:%o', nativeRtpCapabilities);\n\n\t\t\t// This may throw.\n\t\t\tortc.validateRtpCapabilities(nativeRtpCapabilities);\n\n\t\t\t// Get extended RTP capabilities.\n\t\t\tthis._extendedRtpCapabilities = ortc.getExtendedRtpCapabilities(\n\t\t\t\tnativeRtpCapabilities, routerRtpCapabilities);\n\n\t\t\tlogger.debug(\n\t\t\t\t'load() | got extended RTP capabilities:%o',\n\t\t\t\tthis._extendedRtpCapabilities);\n\n\t\t\t// Check whether we can produce audio/video.\n\t\t\tthis._canProduceByKind.audio =\n\t\t\t\tortc.canSend('audio', this._extendedRtpCapabilities);\n\t\t\tthis._canProduceByKind.video =\n\t\t\t\tortc.canSend('video', this._extendedRtpCapabilities);\n\n\t\t\t// Generate our receiving RTP capabilities for receiving media.\n\t\t\tthis._recvRtpCapabilities =\n\t\t\t\tortc.getRecvRtpCapabilities(this._extendedRtpCapabilities);\n\n\t\t\t// This may throw.\n\t\t\tortc.validateRtpCapabilities(this._recvRtpCapabilities);\n\n\t\t\tlogger.debug(\n\t\t\t\t'load() | got receiving RTP capabilities:%o',\n\t\t\t\tthis._recvRtpCapabilities);\n\n\t\t\t// Generate our SCTP capabilities.\n\t\t\tthis._sctpCapabilities = await handler.getNativeSctpCapabilities();\n\n\t\t\tlogger.debug(\n\t\t\t\t'load() | got native SCTP capabilities:%o', this._sctpCapabilities);\n\n\t\t\t// This may throw.\n\t\t\tortc.validateSctpCapabilities(this._sctpCapabilities);\n\n\t\t\tlogger.debug('load() succeeded');\n\n\t\t\tthis._loaded = true;\n\n\t\t\thandler.close();\n\t\t}\n\t\tcatch (error)\n\t\t{\n\t\t\tif (handler)\n\t\t\t\thandler.close();\n\n\t\t\tthrow error;\n\t\t}\n\t}\n\n\t/**\n\t * Whether we can produce audio/video.\n\t *\n\t * @throws {InvalidStateError} if not loaded.\n\t * @throws {TypeError} if wrong arguments.\n\t */\n\tcanProduce(kind: MediaKind): boolean\n\t{\n\t\tif (!this._loaded)\n\t\t\tthrow new InvalidStateError('not loaded');\n\t\telse if (kind !== 'audio' && kind !== 'video')\n\t\t\tthrow new TypeError(`invalid kind \"${kind}\"`);\n\n\t\treturn this._canProduceByKind[kind];\n\t}\n\n\t/**\n\t * Creates a Transport for sending media.\n\t *\n\t * @throws {InvalidStateError} if not loaded.\n\t * @throws {TypeError} if wrong arguments.\n\t */\n\tcreateSendTransport(\n\t\t{\n\t\t\tid,\n\t\t\ticeParameters,\n\t\t\ticeCandidates,\n\t\t\tdtlsParameters,\n\t\t\tsctpParameters,\n\t\t\ticeServers,\n\t\t\ticeTransportPolicy,\n\t\t\tadditionalSettings,\n\t\t\tproprietaryConstraints,\n\t\t\tappData = {}\n\t\t}: TransportOptions\n\t): Transport\n\t{\n\t\tlogger.debug('createSendTransport()');\n\n\t\treturn this._createTransport(\n\t\t\t{\n\t\t\t\tdirection              : 'send',\n\t\t\t\tid                     : id,\n\t\t\t\ticeParameters          : iceParameters,\n\t\t\t\ticeCandidates          : iceCandidates,\n\t\t\t\tdtlsParameters         : dtlsParameters,\n\t\t\t\tsctpParameters         : sctpParameters,\n\t\t\t\ticeServers             : iceServers,\n\t\t\t\ticeTransportPolicy     : iceTransportPolicy,\n\t\t\t\tadditionalSettings     : additionalSettings,\n\t\t\t\tproprietaryConstraints : proprietaryConstraints,\n\t\t\t\tappData                : appData\n\t\t\t});\n\t}\n\n\t/**\n\t * Creates a Transport for receiving media.\n\t *\n\t * @throws {InvalidStateError} if not loaded.\n\t * @throws {TypeError} if wrong arguments.\n\t */\n\tcreateRecvTransport(\n\t\t{\n\t\t\tid,\n\t\t\ticeParameters,\n\t\t\ticeCandidates,\n\t\t\tdtlsParameters,\n\t\t\tsctpParameters,\n\t\t\ticeServers,\n\t\t\ticeTransportPolicy,\n\t\t\tadditionalSettings,\n\t\t\tproprietaryConstraints,\n\t\t\tappData = {}\n\t\t}: TransportOptions\n\t): Transport\n\t{\n\t\tlogger.debug('createRecvTransport()');\n\n\t\treturn this._createTransport(\n\t\t\t{\n\t\t\t\tdirection              : 'recv',\n\t\t\t\tid                     : id,\n\t\t\t\ticeParameters          : iceParameters,\n\t\t\t\ticeCandidates          : iceCandidates,\n\t\t\t\tdtlsParameters         : dtlsParameters,\n\t\t\t\tsctpParameters         : sctpParameters,\n\t\t\t\ticeServers             : iceServers,\n\t\t\t\ticeTransportPolicy     : iceTransportPolicy,\n\t\t\t\tadditionalSettings     : additionalSettings,\n\t\t\t\tproprietaryConstraints : proprietaryConstraints,\n\t\t\t\tappData                : appData\n\t\t\t});\n\t}\n\n\tprivate _createTransport(\n\t\t{\n\t\t\tdirection,\n\t\t\tid,\n\t\t\ticeParameters,\n\t\t\ticeCandidates,\n\t\t\tdtlsParameters,\n\t\t\tsctpParameters,\n\t\t\ticeServers,\n\t\t\ticeTransportPolicy,\n\t\t\tadditionalSettings,\n\t\t\tproprietaryConstraints,\n\t\t\tappData = {}\n\t\t}: InternalTransportOptions\n\t): Transport\n\t{\n\t\tif (!this._loaded)\n\t\t\tthrow new InvalidStateError('not loaded');\n\t\telse if (typeof id !== 'string')\n\t\t\tthrow new TypeError('missing id');\n\t\telse if (typeof iceParameters !== 'object')\n\t\t\tthrow new TypeError('missing iceParameters');\n\t\telse if (!Array.isArray(iceCandidates))\n\t\t\tthrow new TypeError('missing iceCandidates');\n\t\telse if (typeof dtlsParameters !== 'object')\n\t\t\tthrow new TypeError('missing dtlsParameters');\n\t\telse if (sctpParameters && typeof sctpParameters !== 'object')\n\t\t\tthrow new TypeError('wrong sctpParameters');\n\t\telse if (appData && typeof appData !== 'object')\n\t\t\tthrow new TypeError('if given, appData must be an object');\n\n\t\t// Create a new Transport.\n\t\tconst transport = new Transport(\n\t\t\t{\n\t\t\t\tdirection,\n\t\t\t\tid,\n\t\t\t\ticeParameters,\n\t\t\t\ticeCandidates,\n\t\t\t\tdtlsParameters,\n\t\t\t\tsctpParameters,\n\t\t\t\ticeServers,\n\t\t\t\ticeTransportPolicy,\n\t\t\t\tadditionalSettings,\n\t\t\t\tproprietaryConstraints,\n\t\t\t\tappData,\n\t\t\t\thandlerFactory          : this._handlerFactory,\n\t\t\t\textendedRtpCapabilities : this._extendedRtpCapabilities,\n\t\t\t\tcanProduceByKind        : this._canProduceByKind\n\t\t\t});\n\n\t\t// Emit observer event.\n\t\tthis._observer.safeEmit('newtransport', transport);\n\n\t\treturn transport;\n\t}\n}\n"]}